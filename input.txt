project code_generator_model

  output_directory "d:/Users/jpiffret/AppData/Roaming/Dropbox/projets_perso/ada/code_generator_input/examples/model"

  package model

    object_value element ( abstract )
      --
      -- define packages model.element and model.types.element

      limited with model.comment
      use model.types.element
      use model.types.comment
      --
      --  dependances are the first printed lines

      init:
      pre => comment_count = 0 and owned_element_count = 0
      post => pre
      implemenation: null; end_implementation
      --
      --  no parametrs
      --  xyz_count are defined by fields
      --  postconditions are to be copied from preconditions

      owned_comments : vector of model.comment
      owned_elements : vector of model.element
      --
      -- for each vector, generate queries:
      -- xzy_count, get_xyz (index), add_xyz (object)

      owner : access class_t := null;

    end object_value element

    object_value comment ( model.element )

    end object_value comment

  end_package model

  package: model.element;

    use model.types.element;
    use model.types.comment;
    use model.types.namespace;

    class: object_t {abstract};

      field:
        -owned_comments: comment_vector {readOnly, unique};
        queries: +number_of, +get_by_index, +owns
        commands: +add
      end_field;

      field:
        -owned_elements: element_vector {readOnly, unique};
        queries: +number_of, +get_by_index, +owns
        commands: +add
      end_field;

      field:
        -owner: access object_t'class;
      end_field;

      +query has_owner : boolean;
      +query get_owner : not null access constant object_t'class;
      +query is_owned_by ( object : not null access constant object_t'class);
      +query must_be_owned : boolean = true;

    end_class;

    procedure initialize (self: in out object_t'class);
    postcondition (self.number_of_comments = 0 and then self.number_of_owned_elements = 0);

  end_package;

  package: model.named_element;

    use model.element;
    limited use model.namespace;

    class: object_t {abstract}: model.element.object_t;
      field:
        -name: access string;
    end class;

  end_package;
end_project
